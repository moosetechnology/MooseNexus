"
I am a configurable model builder.
I am used to create a Moose model for a `NexusProject`.
The model is generated by a `NexusModelCreator` that knows how to parse the sources of the project.
"
Class {
	#name : 'NexusModelBuilder',
	#superclass : 'Object',
	#instVars : [
		'project',
		'withDependencies',
		'extractor',
		'importer'
	],
	#category : 'MooseNexus-ModelExtraction',
	#package : 'MooseNexus',
	#tag : 'ModelExtraction'
}

{ #category : 'building' }
NexusModelBuilder >> build [
	"Create the model"

	[
	self setUp.
	self extractor run ] ensure: [ self cleanUp ]
]

{ #category : 'cleanup' }
NexusModelBuilder >> cleanUp [
	"delete temp directories"

	(FileLocator home / project directory / 'dependencies')
		ensureDeleteAll
]

{ #category : 'accessing' }
NexusModelBuilder >> extractor [

	^ extractor ifNil: [
		  extractor := NexusModelExtractor forLanguage: project language ]
]

{ #category : 'accessing' }
NexusModelBuilder >> extractor: aNexusModelExtractor [

	extractor := aNexusModelExtractor
]

{ #category : 'accessing' }
NexusModelBuilder >> importer [

	^ importer
]

{ #category : 'accessing' }
NexusModelBuilder >> importer: anObject [

	importer := anObject
]

{ #category : 'initialization' }
NexusModelBuilder >> initialize [

	withDependencies := true
]

{ #category : 'accessing' }
NexusModelBuilder >> project [

	^ project
]

{ #category : 'accessing' }
NexusModelBuilder >> project: aNexusProject [

	project := aNexusProject
]

{ #category : 'building' }
NexusModelBuilder >> setUp [

	| home projectDirectory dependencies |
	home := FileLocator home.
	projectDirectory := home / project directory.
	dependencies := (projectDirectory / 'dependencies') createDirectory.
	project dependencies do: [ :dependency |
		| artifact |
		artifact := home / (dependency at: #path).
		artifact copyTo: dependencies / artifact basename ].
	self extractor target: projectDirectory pathString
]

{ #category : 'accessing' }
NexusModelBuilder >> withDependencies [

	^ withDependencies
]

{ #category : 'accessing' }
NexusModelBuilder >> withDependencies: aBoolean [

	withDependencies := aBoolean
]
